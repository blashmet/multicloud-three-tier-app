---
ignore_git_branch: true

deployments:

  - name: terraform-state-lock

    modules:
        - name: Terraform DynamoDB State Lock
          path: dynamo-state-lock.cfn

    regions:
      - us-east-1

    account_id:
      vcore: 810041203434

  - name: aws-deployment

    modules:

        - name: vpc
          path: vpc.tf
          options:
            terraform_backend_config:
              region: us-east-1
            terraform_backend_cfn_outputs:
              bucket: aws-us-east-1-tf-state-vpc::TerraformStateBucketName
              dynamodb_table: aws-us-east-1-tf-state-vpc::TerraformStateTableName

        - name: gateways
          path: gateways.tf
          options:
            terraform_backend_config:
              region: us-east-1
            terraform_backend_cfn_outputs:
              bucket: aws-us-east-1-tf-state-gateways::TerraformStateBucketName
              dynamodb_table: aws-us-east-1-tf-state-gateways::TerraformStateTableName

        - name: routes
          path: routes.tf
          options:
            terraform_backend_config:
              region: us-east-1
            terraform_backend_cfn_outputs:
              bucket: aws-us-east-1-tf-state-routes::TerraformStateBucketName
              dynamodb_table: aws-us-east-1-tf-state-routes::TerraformStateTableName

        - name: secrets
          path: secrets.cfn

        - name: cfn-secret-provider
          path: cfn-secret-provider.cfn

        - name: ec2-keys
          path: ec2-keys.cfn

        - name: security-groups
          path: security-groups.tf
          options:
            terraform_backend_config:
              region: us-east-1
            terraform_backend_cfn_outputs:
              bucket: aws-us-east-1-tf-state-security-groups::TerraformStateBucketName
              dynamodb_table: aws-us-east-1-tf-state-security-groups::TerraformStateTableName

        - name: rds
          path: rds.tf
          options:
            terraform_backend_config:
              region: us-east-1
            terraform_backend_cfn_outputs:
              bucket: aws-us-east-1-tf-state-rds::TerraformStateBucketName
              dynamodb_table: aws-us-east-1-tf-state-rds::TerraformStateTableName

        - name: beanstalk-app
          path: beanstalk-app.tf
          options:
            terraform_backend_config:
              region: us-east-1
            terraform_backend_cfn_outputs:
              bucket: aws-us-east-1-tf-state-rds::TerraformStateBucketName
              dynamodb_table: aws-us-east-1-tf-state-rds::TerraformStateTableName

        - name: iam-roles
          path: iam-roles.tf
          options:
            terraform_backend_config:
              region: us-east-1
            terraform_backend_cfn_outputs:
              bucket: aws-us-east-1-tf-state-iam-roles::TerraformStateBucketName
              dynamodb_table: aws-us-east-1-tf-iam-roles::TerraformStateTableName

    regions:
      - us-east-1

    account_id:
      vcore: 810041203434