# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:

- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.x' 
    addToPath: true 
    #architecture: 'x64' # Options: x86, x64 (this argument applies only on Windows agents)

- script: |
    echo "Starting pipeline..."
    echo "Current directory is:"
    pwd
    echo "python version is"
    python --version
    echo "pip version is"
    pip --version
    echo "installing pipenv"
    pip install pipenv
    #echo "pipenv version is"
    pipenv --version
    #echo "Updating packages..."
    #sudo apt update
    #echo "Installing pip..."
    #sudo apt install python3-pip
    #echo "Installing runway..."
    #pip install runway
    #echo "Runway version is:"
    #runway --version
    echo 'Changing directory to $(cloud_provider), ${service_name}, ${environment}'
    cd '$(Agent.BuildDirectory)\runway\multicloud\aws\demo-service-1\dev\'
    echo "Current directory is:"
    pwd
    #echo "Setting CI variable..."
    #export CI=1
    #echo 'CI variable is: ($null = interactive, 1 = CI\CD)'
    #echo "$CI"
    #echo "Runway version is:"
    #pipenv run runway --version
    #runway deploy

  displayName: 'Run a multi-line script'

- script: python -m pipenv lock -r > requirements.txt
  displayName: 'Create requirements.txt from Pipfile'

- script: pip install -r requirements.txt
  displayName: 'Install requirements.txt'